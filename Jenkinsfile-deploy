pipeline {
  agent {
    label 'maven'
  }
  stages {
    stage('Build') {
      steps {
        git url: 'https://github.com/spring-projects/spring-petclinic.git'
        sh "mvn package -DskipTests"
      }
    }
    stage('Build') {
      steps {
        sh "mvn test"
      }
    }
    stage('Deploy') {
      steps {
        script {
          openshift.withCluster() {
            openshift.withProject() {
              def pom = readMavenPom file: 'pom.xml'
              openshift.startBuild("spring-petclinic", "--from-file=spring-petclinic-${pom.version}.jar")
            }
          }
        }
      }
    }
  }
}

